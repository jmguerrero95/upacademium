<HTML>
<HEAD>
<TITLE>INGENIUM::ERP::ENTERPRISE RESOURCE PLANNING</TITLE>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<style> body, html {margin:0px; padding: 0px; overflow: hidden;} </style>
<script>
var useBSNns = true;

$(document).ready(
		function()
		{
			$('#dock2').Fisheye(
				{
					maxWidth: 60,
					items: 'a',
					itemsText: 'span',
					container: '.dock-container2',
					itemWidth: 40,
					proximity: 80,
					alignment : 'left',
					valign: 'bottom',
					halign : 'center'
				}
			)
		}
	);
	

	
window.status='Diseñado y Desarrollado por Omnisoft Cia Ltda http://www.omnisoft.cc';
</script>

<link href='../lib/autosuggest2/css/autosuggest_inquisitor.css' rel="stylesheet" type="text/css">

<script language="javascript" src= "../lib/tools/cookies.js" ></script>
<script language='javascript' src="../lib/tools/omnisoftTools.js"></script>
<script language='javascript' src="../lib/tools/omnisoftMenu.js"></script>
<script language="javascript" src= "../lib/aw/lib/aw.js" ></script>
<link href="../lib/styles/omnisoft.css" rel="stylesheet" type="text/css">
<link href="../lib/tools/omnisoftValidar.css" rel="stylesheet" type="text/css">
<link href="../lib/zpmenu/themes/images.css" rel="stylesheet" type="text/css">
<link href="../lib/grid/styles/omnisoftGrid.css" rel="stylesheet" type="text/css">

<script language='javascript' src="../lib/tools/omnisoftValidar.js"></script>
<script language="javascript" src="../lib/mask/event-listener.js"></script>
<script language="javascript" src="../lib/mask/masked-input.js"></script>
<script language="javascript" src="../lib/mask/enter-as-tab.js"></script>
<script language="javascript" src="../lib/mask/auto-tab.js"></script>

<script language='javascript' src="../lib/grid/omnisoftDB.js"></script>
<script language='javascript' src="../lib/combo/omnisoftComboBox.js"></script>

<script language="javascript1.2" src="../lib/zpmenu/utils/utils.js"></script>
<script language="javascript1.2" src="../lib/zpmenu/src/menu.js"></script>

<link rel="stylesheet" type="text/css" media="all" href="../lib/jscalendar/calendar-blue2.css" title="win2k-cold-1" />
  <script type="text/javascript" src="../lib/jscalendar/calendar.js"></script>
  <script type="text/javascript" src="../lib/jscalendar/lang/calendar-en.js"></script>
  <script type="text/javascript" src="../lib/jscalendar/calendar-setup.js"></script>

<script language="javascript" src="../lib/autosuggest2/js/bsn.AutoSuggest_2.1_comp_grid.js"> </script>
<script language="javascript" src="../lib/autosuggest2/js/bsn.AutoSuggest_2.1_comp.js"> </script>
<script language="javascript" src= "../lib/grid/omnisoftGrid.js" ></script>
<script>
       


function procesarCambio() {
 //alert(getCookie('tipo_usuario'));
 //alert(getCookie('tipo_usuario')+" | "+getCookie('serial_epl')+" | "+getCookie('serial_usr'));
 
  if (validarPassword()) {        
  	var anterior = document.PaginaDatos.anterior.value;
	
	anterior = anterior.toUpperCase();
	
//	SQLCommand ='select serial_alu from alumno where serial_alu = '+getCookie('serial_alu')+' and clave_alu = md5("'+anterior+'")';
		
	    if(getCookie('tipo_usuario')=='FUNCIONARIO'){                             
			SQLCommand = "select SERIAL_USR from upusuario where SERIAL_USR="+getCookie('serial_usr')+" and CLAVE_USR like md5('"+anterior+"')";
		}
		
		if(getCookie('tipo_usuario')=='PROFESOR'){                             
			SQLCommand = "select SERIAL_EPL from empleado where SERIAL_EPL ="+getCookie('serial_epl')+" and clave_epl like md5('"+anterior+"')";
		}
	//prompt("",SQLCommand);
	
	var objDBComando=new omnisoftDB(SQLCommand,"../lib/server/omnisoftSQLData.php",'recuperarDatos');
    objDBComando.executeQuery();					           
	}
	  
}
	
	
function recuperarDatos(data){
	 var datos=data.split('|')[1].split('~');
    	
				if(datos!=''){				
				var nuevo = document.PaginaDatos.nuevo.value;	
				var act_fecha = document.PaginaDatos.act_fecha.value=fechaSistema();
				nuevo = nuevo.toUpperCase();		

				//SQLCommand1 ='update alumno set clave_alu = md5("'+nuevo+'") where serial_alu = '+datos;	
				
				if(getCookie('tipo_usuario')=='FUNCIONARIO'){                             
						SQLCommand1 = "update upusuario set FECHA_USR = ('"+act_fecha+"'), CLAVE_USR = md5('"+nuevo+"') where SERIAL_USR="+datos;
				}
		
				if(getCookie('tipo_usuario')=='PROFESOR'){                             
					 SQLCommand1 = "update empleado set clave_epl = md5('"+nuevo+"') where SERIAL_EPL="+datos;
				}
				
				
				
				
				//prompt("",SQLCommand1);

							                
				var objDBComando1=new omnisoftDB(SQLCommand1,"../lib/server/omnisoftSQLData.php");
    				objDBComando1.executeQuery();					
					alert("Su password fue actualizado correctamente")
					window.close()
				}
				else
					alert("Su password anterior no es correcto")
	
	//alert(datos)
	
	//alert(valorFacturado)
	
}

function validarPassword(){

if (document.PaginaDatos.anterior.value=='') {
   alert('Por favor ingrese su password anteior');
   document.PaginaDatos.anterior.focus();
   return false;
}

if (document.PaginaDatos.nuevo.value=='') {
   alert('Por favor ingrese su nuevo password');
   document.PaginaDatos.nuevo.focus();
   return false;
}

if (document.PaginaDatos.confirmar.value=='') {
   alert('Por favor confirme su nuevo password');
   document.PaginaDatos.confirmar.focus();
   return false;
}

if (document.PaginaDatos.confirmar.value != document.PaginaDatos.nuevo.value){
   alert('No ha confirmado correctamente su nuevo password');
   document.PaginaDatos.confirmar.focus();
   return false;
}


    return true;
}



</script>
</head>




<script language="JavaScript" type="text/JavaScript">
<!--
function MM_preloadImages() { //v3.0
  var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
    var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
    if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
}

function MM_swapImgRestore() { //v3.0
  var i,x,a=document.MM_sr; for(i=0;a&&i<a.length&&(x=a[i])&&x.oSrc;i++) x.src=x.oSrc;
}

function MM_findObj(n, d) { //v4.01
  var p,i,x;  if(!d) d=document; if((p=n.indexOf("?"))>0&&parent.frames.length) {
    d=parent.frames[n.substring(p+1)].document; n=n.substring(0,p);}
  if(!(x=d[n])&&d.all) x=d.all[n]; for (i=0;!x&&i<d.forms.length;i++) x=d.forms[i][n];
  for(i=0;!x&&d.layers&&i<d.layers.length;i++) x=MM_findObj(n,d.layers[i].document);
  if(!x && d.getElementById) x=d.getElementById(n); return x;
}

function MM_swapImage() { //v3.0
  var i,j=0,x,a=MM_swapImage.arguments; document.MM_sr=new Array; for(i=0;i<(a.length-2);i+=3)
   if ((x=MM_findObj(a[i]))!=null){document.MM_sr[j++]=x; if(!x.oSrc) x.oSrc=x.src; x.src=a[i+2];}
}
//-->
</script>
<style type="text/css">
<!--
.style1 {	color: #FFFFFF;
	font-weight: bold;
}
-->
</style>
<script>
//select alu.serial_alu, concat_ws(" ",apellidopaterno_alu,apellidomaterno_alu, nombre1_alu, nombre2_alu) from materiamatriculada as mmat, alumnomalla as am, alumno alu where mmat.serial_ama = am.serial_ama and am.serial_alu = alu.serial_alu and mmat.serial_per = 116
function seleccionarAlumno(){

 cserial_alu.objDBComando.sqlCommand='select alu.serial_alu, concat_ws(" ",apellidopaterno_alu,apellidomaterno_alu, nombre1_alu, nombre2_alu) as alumno from materiamatriculada as mmat, alumno as alu where mmat.serial_alu = alu.serial_alu and mmat.serial_per = '+ document.PaginaDatos.serial_per.value +' order by apellidopaterno_alu'; 
  cserial_alu.objDBComando.executeQuery();
//alert (document.PaginaDatos.serial_per.value);

}

function MostrarMaterias(){
   var sql='select serial_hrr,concat(nombre_mat,\'=>\',seccion_hrr) as materia from materia as mat,detallecalendariounificado as dcun,horario as hrr where hrr.serial_dcun=dcun.serial_dcun and dcun.serial_mat=mat.serial_mat  and hrr.SERIAL_PER='+document.PaginaDatos.serial_per.value+' and hrr.serial_epl='+document.PaginaDatos.serial_epl.value+' order by materia';
  	cserial_hrr.objDBComando.sqlCommand=sql;
 //cserial_maa.objDBComando.sqlCommand=sql_1;
// prompt('sql',sql);
  cserial_hrr.objDBComando.executeQuery();
  
}

</script>
</HEAD>
<BODY onLoad="initDisableRight();"  LEFTMARGIN=0 TOPMARGIN=0 MARGINWIDTH=0 MARGINHEIGHT=0 onLoad="MM_preloadImages('../images/bot_insertar_b.gif','../images/bot_editar_b.gif','../images/bot_buscar_b.gif','../images/bot_eliminar_b.gif','../images/bot_correo_b.gif','../images/bot_graficar_b.gif','../images/bot_imprimir_b.gif','../images/bot_ayuda_b.gif','../images/bot_acercad_b.gif','../images/bot_salir_b.gif','../images/bot_home_b.gif','../images/bot_inicio_b.gif','../images/bot_anterior_b.gif','../images/bot_siguiente_b.gif','../images/bot_ultimo_b.gif','../images/bot_xml_b.gif','../images/bot_excel_b.gif')">
<script> window.status='Diseñado y Desarrollado por Omnisoft Cia Ltda http://www.omnisoft.cc';</script>
<form method="POST" enctype="multipart/form-data"  name="PaginaDatos" onClick="highlight(event)" onKeyUp="highlight(event)">

      
    
     
        <table width="100%" border="0" cellspacing="0" cellpadding="0">
          <tr>            <td> <div align="right">
                <table width="100%" height="45" border="0" cellpadding="0" cellspacing="0" class="maintoptitle" >
                  <tr valign="">
                    <td width="222" height="45" valign="" class="ingeniumtoptitle"></td>                    <td width="482"  class="toptitle" > <center>
<br>
						CAMBIO DE PASSWORD
                    </center></td>
					
                    <td width="40" valign="bottom" ><img id="imgFoto" src="../fotos/foto.jpg" width="37" height="45"></td>
                     <td width="169"  valign="middle" class="toptitle">
                                        <script>document.write(getCookie('nombre_usr')+' '+getCookie('apellido_usr')); </script></td>
                    <td width="128" class="logotoptitle"></td>

                  </tr>
                </table>
               
              </td>
          </tr>
          
          <tr>            
		  <td height="200" valign="" >
			<div align="">
                <table  width="100%" height="200" border="1" cellpadding="0" cellspacing="0"  bordercolordark="#FFFFFF" bordercolorlight="#000000" class="formtable">
                  <tr>
                    <td height="200" class="inputtitle" >
					
					<table width="421"  height="76" align="center" >
                      <tr>
                        <td width="136" height="17"  class="inputtitle">Password Anterior :</td>
                        <td width="206" ><script>
 						//var cserial_per=new omnisoftComboBox('cserial_per','serial_per','select serial_per,nombre_per from periodo where serial_suc='+getCookie('serial_suc')+' order by nombre_per','250px',true,'','',seleccionarAlumno);						
						
						
						</script>                        
						  <input name="anterior" id="anterior" type="text" class="string" size="50" maxlength="50"></td>                        
                      </tr>
					  
					  <tr>
					  	<td width="136" height="29" class="inputtitle">Nuevo password   : </td>
		   						 <td height="29" colspan="2"><span class="inputtitle">
								 
						<input name="nuevo" id="nuevo" type="password" class="string" size="50" maxlength="50">
		    </span></td>					 
					  </tr>
                      
					  <tr>
                        <td height="18"  class="inputtitle">Confirme su nuevo password :</td>
                        <td>  
						  <input name="confirmar" id="confirmar" type="password" class="string" size="50" maxlength="50"></td>                                              
                       </tr>
					   
                      <tr>
                      <td><input name="act_fecha" type="hidden" id="act_fecha" size="10" maxlength="10" readonly class="date"></td>
					 </tr>
					 </table>
					 
					 <table align="center" >
					 <tr>
                        <td height="34"  class="inputtitle"><a href="#" onClick="procesarCambio()"></a></td>
						<td height="34" > <input  border="3" type="button" value="Cambiar" onClick="procesarCambio()" ></td>
						<td height="34"  class="inputtitle"><a href="../modulos/modulos.html" ></a></td>                        
                        
                        
                        
                      </tr>
                    </table>
			</td>
		</tr>
		</table>
		</div>
		</td>
	</tr>
	</table>
	
	</td>
</tr>
</table>

</form>
</body>



<script>
//omnisoftLoadData(document.PaginaDatos);
document.PaginaDatos.act_fecha.value=fechaSistema();
//	OmnisoftPerfilUsuarioFormulario();
</script>

</BODY>

</HTML>

